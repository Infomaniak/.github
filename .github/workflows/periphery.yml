name: Periphery

on:
  workflow_call:
    inputs:
      setup_step:
        required: false
        type: string
        default: 'echo "Nothing to do"'

jobs:
  periphery:
    runs-on: [ self-hosted, iOS ]

    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - uses: jdx/mise-action@6d1e696aa24c1aa1bcc1adea0212707c71ab78a8
        with:
          cache: false
      - name: Setup Step
        run: ${{ inputs.setup_step }}
      - name: Generate
        run: tuist install && tuist generate
      - name: Periphery
        run: periphery scan --retain-codable-properties --format github-actions --relative-results --strict
